#!/usr/bin/python3
#    _____ _     ____  ____  ____  ____  _____ 
#   /    // \   /  _ \/  __\/  _ \/  __\/__ __\
#   |  __\| |   | / \||  \/|| / \||  \/|  / \  
#   | |   | |_/\| |-|||  __/| \_/||    /  | |  
#   \_/   \____/\_/ \|\_/   \____/\_/\_\  \_/  
#

import os
import sys
from pathlib import Path
from subprocess import call, Popen, check_output, PIPE

FILENAME = sys.argv[1]
TERMINAL = os.environ.get("TERMINAL")
with open(FILENAME, "r") as file:
    SHEBANG = file.readline()


def run_python(filename):
    Popen(["killall", "ipython"])
    Popen([TERMINAL, "-e", "ipython", "-i", "--no-banner"] + [filename])

def run_latex(filename):
    Popen(["killall", "less"])
    with open(f"/tmp/run.sh", "w") as file:
        file.write(f"latexmk -pdf -synctex=1 -interaction=nonstopmode {filename} | less")
    Popen([TERMINAL, "-e", f"bash /tmp/run.sh"])


if __name__ == "__main__":
    if FILENAME.endswith(".py") or "python" in SHEBANG:
        run_python(FILENAME)
    elif FILENAME.endswith(".tex"):
        run_latex(FILENAME)
    else:
        exit(1)
